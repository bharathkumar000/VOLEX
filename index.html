<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VOLEX | Spatial Voxel Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
  <!-- Import Map for CDNs -->
  <!-- Global Error Handler -->
  <script>
    window.onerror = function (msg, url, line) {
      alert("Error: " + msg + "\nLine: " + line);
    };
  </script>
  <!-- Import Map for CDNs -->
  <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/examples/jsm/controls/OrbitControls.js": "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js",
          "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.9/+esm"
        }
      }
  </script>
</head>

<body>
  <div id="app">
    <!-- 3D Container (Overlay) -->
    <canvas id="canvas-3d"
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none;"></canvas>

    <!-- Webcam Input (Visible as background) -->
    <video id="webcam"
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; transform: scaleX(-1);"
      autoplay playsinline></video>

    <!-- Hand Tracking Visualization Canvas -->
    <canvas id="hand-canvas"
      style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; transform: scaleX(-1);"></canvas>

    <!-- UI Overlay -->
    <div id="ui-layer">

      <!-- Header / Status -->
      <header class="ui-header">
        <div class="logo">VOLEX <span class="version">v0.1</span></div>
        <div class="status-indicators">
          <div id="status-hand" class="status-item disconnected">
            <span class="dot"></span> Hand Tracking
          </div>
          <div id="fps-counter" class="status-item"></div>
        </div>
      </header>

      <!-- Main Interactions -->
      <div class="interaction-zone">
        <div id="gesture-feedback" class="gesture-card">
          <div class="icon-zone">
            <span id="gesture-icon">âœ‹</span>
          </div>
          <div class="text-zone">
            <span class="label">Current Gesture</span>
            <span id="gesture-name" class="value">None</span>
          </div>
        </div>

        <div id="tool-feedback" class="tool-card">
          <div class="text-zone">
            <span class="label">Tracking Accuracy</span>
            <span id="tracking-accuracy" class="value">--</span>
          </div>
        </div>
      </div>

      <!-- Controls / Edit Mode -->
      <aside class="controls-panel" id="controls-panel">
        <button class="btn-minimize" id="btn-minimize" title="Minimize Panel">
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div class="panel-section">
          <button id="btn-toggle-camera" class="btn-primary" style="margin-bottom: 0.5rem;">
            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <span>Stop Camera</span>
          </button>

          <button id="btn-toggle-mode" class="btn-primary" style="margin-bottom: 0.5rem;">
            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            <span>Preview Mode</span>
          </button>

          <button id="btn-train-gestures" class="btn-primary"
            style="margin-bottom: 0.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
            <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            <span>Train Gestures</span>
          </button>

          <div style="display: flex; gap: 0.5rem;">
            <button id="btn-reset" class="btn-primary" style="flex: 1;" title="Clear Scene">
              <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              <span>Clear</span>
            </button>
            <button id="btn-undo" class="btn-primary" style="flex: 1;" title="Undo Last Action">
              <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
              </svg>
              <span>Undo</span>
            </button>
          </div>
        </div>
        <div class="panel-section grid-2">
          <button id="btn-save" class="btn-secondary">Save JSON</button>
          <button id="btn-load" class="btn-secondary">Load JSON</button>
          <input type="file" id="file-input" accept=".json" style="display: none;" />
        </div>
        <div class="panel-section help-text">
          <h3>Gestures</h3>
          <ul>
            <li><strong>Pinch Index:</strong> Create/Draw</li>
            <li><strong>Open Palm:</strong> Hover/Select</li>
            <li><strong>Swipe Left:</strong> Delete</li>
          </ul>
          <div class="toggle-wrapper">
            <label for="mouse-fallback">Mouse/Keys Fallback</label>
            <input type="checkbox" id="mouse-fallback">
          </div>
        </div>
      </aside>

      <!-- Loading / Start Screen -->
      <div id="start-screen" class="overlay-screen">
        <div class="content">
          <h1>VOLEX</h1>
          <p>Spatial Computing Voxel Editor</p>
          <div class="loader" id="loader">Loading Neural Nets...</div>
          <button id="btn-start" class="btn-large" disabled>Start Camera</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Gesture Training Modal -->
  <div id="training-modal" class="overlay-screen" style="display: none;">
    <div class="content" style="max-width: 600px;">
      <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">ðŸŽ¯ Gesture Training</h2>
      <p style="margin-bottom: 2rem;">Calibrate the system to YOUR hand for better accuracy!</p>

      <div id="training-instruction"
        style="background: rgba(255,255,255,0.05); padding: 2rem; border-radius: 20px; border: 2px solid rgba(255,255,255,0.1); margin-bottom: 2rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;" id="training-emoji">ðŸ‘‹</div>
        <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #00f0ff;" id="training-gesture-name">Open Palm</h3>
        <p style="color: #888; margin-bottom: 1rem;" id="training-description">Show your open hand with all fingers
          extended</p>
        <div
          style="background: rgba(0,0,0,0.3); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem;">
          <div id="training-progress-bar"
            style="height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); width: 0%; transition: width 0.3s;">
          </div>
        </div>
        <p style="color: #666; font-size: 0.9rem;"><span id="training-samples">0</span>/10 samples collected</p>
      </div>

      <div style="display: flex; gap: 1rem; justify-content: center;">
        <button id="btn-skip-training" class="btn-large"
          style="background: rgba(255,255,255,0.1); font-size: 0.9rem; padding: 0.8rem 2rem;">Skip</button>
        <button id="btn-finish-training" class="btn-large"
          style="display: none; font-size: 0.9rem; padding: 0.8rem 2rem;">Finish Training</button>
      </div>

      <p style="margin-top: 2rem; font-size: 0.85rem; color: #666;">
        Step <span id="training-step">1</span> of 4
      </p>
    </div>
  </div>

  <script type="module" src="./script.js"></script>
</body>

</html>